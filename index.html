<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bungkii</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Kanit&display=swap');

    body {
      font-family: 'Kanit', sans-serif;
      background-color: #f0f2f5;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      color: #071952;
    }
    .container {
      background: #fff;
      max-width: 850px;
      width: 100%;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgb(0 0 0 / 0.1);
      display: flex;
      overflow: hidden;
    }
    .left, .right {
      padding: 40px 36px;
      flex: 1;
    }
    .left {
      border-right: 1px solid #ddd;
    }
    h2 {
      margin-top: 0;
      font-weight: 700;
      font-size: 28px;
      margin-bottom: 20px;
      color: #071952;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 16px;
      margin-top: 20px;
      cursor: pointer;
    }
    input[type="text"] {
      width: 100%;
      padding: 14px 16px;
      font-size: 17px;
      border-radius: 6px;
      border: 1.5px solid #ccc;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
    }
    input[type="text"]:focus {
      border-color: #071952;
      outline: none;
    }
    .package {
      margin-top: 14px;
      font-size: 17px;
      cursor: pointer;
      user-select: none;
      display: flex;
      align-items: center;
      gap: 12px;
      color: #071952;
      font-weight: 600;
    }
    .package input {
      width: 22px;
      height: 22px;
      cursor: pointer;
      accent-color: #071952;
    }
    button {
      margin-top: 36px;
      width: 100%;
      background-color: #071952;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 20px;
      font-weight: 700;
      padding: 16px 0;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:disabled {
      background-color: #555a7e;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      background-color: #0a1a4a;
    }
    .qr-section {
      margin-top: 30px;
      text-align: center;
      user-select: none;
    }
    .qr-section img {
      width: 220px;
      height: 220px;
      object-fit: contain;
      border-radius: 14px;
      border: 2px solid #ddd;
      background-color: white;
      box-shadow: 0 0 10px rgb(0 0 0 / 0.05);
    }
    .qr-section p {
      margin-top: 16px;
      font-size: 18px;
      font-weight: 600;
      color: #071952;
    }
    .success-code {
      margin-top: 40px;
      border-top: 1px solid #ddd;
      padding-top: 28px;
      text-align: center;
      color: #0a7c3c;
      font-weight: 700;
      font-size: 22px;
      user-select: text;
    }
    .success-code p.code {
      font-size: 28px;
      font-weight: 900;
      letter-spacing: 2px;
      margin: 12px 0 0;
      background: #d2f5d2;
      display: inline-block;
      padding: 10px 24px;
      border-radius: 8px;
      color: #086a13;
      user-select: all;
    }
    .payment-method {
      display: flex;
      align-items: center;
      margin-bottom: 28px;
      font-size: 18px;
      color: #071952;
      gap: 12px;
      font-weight: 600;
      user-select: none;
    }
    .payment-method svg {
      fill: #071952;
      width: 28px;
      height: 28px;
    }
    .loading-text {
      margin-top: 18px;
      font-size: 16px;
      color: #444;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="left">
      <h2>สมัครพรีเมี่ยม ให้บุงกี</h2>
      <label for="phoneEmail">ชื่อไอจี</label>
      <input id="phoneEmail" type="text" placeholder="ชื่อหรือเบอร์โทรติดต่อ" autocomplete="off" />

      <label>เลือกแพ็กเกจ</label>
      <label class="package">
        <input type="radio" name="package" value="99" />
        1 สัปดาห์ – 99 บาท
      </label>
      <label class="package">
        <input type="radio" name="package" value="299" />
        1 เดือน – 299 บาท
      </label>
      <label class="package">
        <input type="radio" name="package" value="1190" />
        1 ปี – 1190 บาท
      </label>

      <div class="qr-section" id="qrSection" style="display:none;">
        <h2>สแกน QR พร้อมเพย์ เพื่อชำระเงิน</h2>
        <img id="qrImage" src="" alt="QR PromptPay" />
        <p>ยอดที่ต้องชำระ: <strong id="amountText"></strong> บาท</p>
        <p class="loading-text" id="loadingText" style="display:none;">กำลังตรวจสอบยอดโอน โปรดรอสักครู่...</p>
      </div>
    </div>

    <div class="right">
      <h2>วิธีชำระเงิน</h2>
      <div class="payment-method">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5,4 L19,4 C20.1,4 21,4.9 21,6 L21,18 C21,19.1 20.1,20 19,20 L5,20 C3.9,20 3,19.1 3,18 L3,6 C3,4.9 3.9,4 5,4 Z M12,16 L17,16 L17,14 L12,14 L12,16 Z M7,16 L10,16 L10,14 L7,14 L7,16 Z M12,12 L17,12 L17,10 L12,10 L12,12 Z M7,12 L10,12 L10,10 L7,10 L7,12 Z" /></svg>
        QR promptpay
      </div>

      <button id="payBtn">ชำระเงิน</button>

      <div class="success-code" id="successCode" style="display:none;">
        <p>จ่ายสักที</p>
        <p>รหัสลับของมึงคือ</p>
        <p class="code" id="redeemCodeText"></p>
      </div>
    </div>
  </div>

  <script>
    const promptpayNumber = "0925384159";
    const payBtn = document.getElementById("payBtn");
    const phoneEmailInput = document.getElementById("phoneEmail");
    const qrSection = document.getElementById("qrSection");
    const qrImage = document.getElementById("qrImage");
    const amountText = document.getElementById("amountText");
    const loadingText = document.getElementById("loadingText");
    const successCode = document.getElementById("successCode");
    const redeemCodeText = document.getElementById("redeemCodeText");

    let selectedPackage = null;

    // อัพเดต QR code และยอดเมื่อเลือกแพ็คเกจ
    document.querySelectorAll('input[name="package"]').forEach(radio => {
      radio.addEventListener("change", () => {
        selectedPackage = radio.value;
        amountText.textContent = selectedPackage;
        qrImage.src = `https://promptpay.io/${promptpayNumber}/${selectedPackage}.png`;
        qrSection.style.display = "block";
        successCode.style.display = "none";
        loadingText.style.display = "none";
        payBtn.disabled = false;
        payBtn.textContent = "ชำระเงิน";
      });
    });

    // สร้างโค้ด Redeem แบบสุ่ม
    function generateRedeemCode() {
      const part1 = Math.random().toString(36).substring(2, 6).toUpperCase();
      const part2 = Math.random().toString(36).substring(2, 6).toUpperCase();
      return `${part1}-${part2}`;
    }

    // *** ตัวอย่างจำลองตรวจสอบยอดโอน ***
    // สมมติว่าเช็ค API จริงได้ จะทำ Polling ตรวจสอบยอด
    const checkPaymentStatus = () => {
      return new Promise((resolve) => {
        // จำลองเช็คยอดโอนสำเร็จหลัง 7 วินาที
        setTimeout(() => resolve(true), 10000);
      });
    };

    payBtn.addEventListener("click", async () => {
      const phoneEmail = phoneEmailInput.value.trim();

      if (!phoneEmail) {
        alert("กรอกชื่อไอจี");
        phoneEmailInput.focus();
        return;
      }
      if (!selectedPackage) {
        alert("กรุณาเลือกแพ็คเกจ");
        return;
      }

      payBtn.disabled = true;
      payBtn.textContent = "รอตรวจสอบยอดโอน...";
      loadingText.style.display = "block";
      successCode.style.display = "none";

      // เรียกเช็คยอดโอน (mock)
      const paid = await checkPaymentStatus();

      loadingText.style.display = "none";

      if (paid) {
        const redeemCode = generateRedeemCode();
        redeemCodeText.textContent = redeemCode;
        successCode.style.display = "block";
        payBtn.disabled = false;
        payBtn.textContent = "ชำระเงิน";

        // ส่งข้อมูลไป Google Apps Script
        fetch("https://script.google.com/macros/s/AKfycbzZz43qePZLX1CsmDwsuiYGh49kdDuV_HD3-5IEkjk4p2OVcDaXzMryZFnxO83AHRJI/exec", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            phoneOrEmail: phoneEmail,
            packageName: `${selectedPackage} บาท`,
            amount: Number(selectedPackage),
            redeemCode: redeemCode,
            status: "success"
          })
        }).catch(err => {
          console.error("ส่งข้อมูลล้มเหลว", err);
        });
      } else {
        alert("ไม่พบยอดชำระ กรุณาตรวจสอบและลองใหม่อีกครั้ง");
        payBtn.disabled = false;
        payBtn.textContent = "ชำระเงิน";
      }
    });
  </script>
</body>
</html>
